<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<script type="text/javascript">
            (function(){var phoneWidth=parseInt(window.screen.width),phoneScale=phoneWidth/750,ua=navigator.userAgent;if(/Android (\d+\.\d+)/.test(ua)){var version=parseFloat(RegExp.$1);if(version>2.3){document.write('<meta name="viewport" content="width=640, minimum-scale = '+phoneScale+", maximum-scale = "+phoneScale+', target-densitydpi=device-dpi">')}else{document.write('<meta name="viewport" content="width=750, target-densitydpi=device-dpi">')}}else{document.write('<meta name="viewport" content="width=750, user-scalable=no, target-densitydpi=device-dpi">')};})();
		</script>
		<meta name="Description" contect="版权百科-版权数据服务专家">
		<meta  name="apple-mobile-web-app-capable" content="yes"/>
		<meta name="apple-mobile-web-app-status-bar-style" content="black" />
		<meta content="telephone=no" name="format-detection" />
		<meta name="format-detection" content="email=no" />
		<meta name="full-screen" content="true"/>
		<meta name="screen-orientation" content="portrait"/>
		<meta name="x5-fullscreen" content="true"/>
		<meta name="360-fullscreen" content="true"/>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta http-equiv="expires" content="0" />
		<meta http-equiv="pragma" content="no-cache" />
		<meta http-equiv="Cache-Control" content="no-cache, must-revalidate" />
		<meta name="apple-touch-fullscreen" content="yes" />
		<title>版权百科</title>
		<link rel="stylesheet" type="text/css" href="/app/stylesheets/index.css" />
		<link rel="stylesheet" type="text/css" href="/app/stylesheets/mescroll.css" />
		<link rel="stylesheet" type="text/css" href="/lib/swiper/swiper-3.4.2.min.css" />
        <link rel="stylesheet" type="text/css" href="/font/iconfont.css"/>
		<% include('../common/baidu_tj') %>
	</head>

	<body>
		<div class="app mescroll" id="mescroll">
			<!--<div class="app-header" id="app-header">-->
				<!--版权百科-->
				<!--<a class="app-images icon_more"></a>-->
			<!--</div>-->
			<div class="banner">
				<span class="app-images bg_logo logo-img"></span>
				<div class="search-wrap">
					<form action="/list" method="get" class="search-form">
						<span class="app-images icon_Search"></span>
						<input class="search-input" name="keyword" placeholder="输入作品名称、作者。如：盗墓笔记">
						<a class="app-images btu_s search_btn">搜索</a>
					</form>
				</div>
			</div>
			<div class="main-wrap" id="indexApp">
				<div class="nav swiper-container" id="topNav">
					<div class="swiper-wrapper">
						<div class="swiper-slide active" i="0"><a>小说</a></div>
						<div class="swiper-slide" i="1"><a>漫画</a></div>
						<div class="swiper-slide" i="2"><a>音乐</a></div>
						<div class="swiper-slide" i="3"><a>电影</a></div>
						<div class="swiper-slide" i="4"><a>电视剧</a></div>
						<div class="swiper-slide" i="5"><a>体育赛事</a></div>
						<div class="swiper-slide" i="6"><a>动画片</a></div>
						<div class="swiper-slide" i="7"><a>卡通电影</a></div>
						<!--<div class="swiper-slide" i="8"><a>移动APP</a></div>-->
						<div class="swiper-slide" i="8"><a>数字货币</a></div>
					</div>
				</div>
				<div class="fixed-wrap">
					<div class="search-wrap">
						<form action="/list" method="get" class="search-form">
							<span class="app-images icon_Search"></span>
							<input class="search-input" name="keyword" placeholder="输入作品名称、作者。如：盗墓笔记">
							<a class="app-images btu_s search_btn">搜索</a>
						</form>
					</div>
					<div class="nav navFixed swiper-container" id="fixNav">
						<div class="swiper-wrapper">
							<div class="swiper-slide active" i="0"><a>小说</a></div>
							<div class="swiper-slide" i="1"><a>漫画</a></div>
							<div class="swiper-slide" i="2"><a>音乐</a></div>
							<div class="swiper-slide" i="3"><a>电影</a></div>
							<div class="swiper-slide" i="4"><a>电视剧</a></div>
							<div class="swiper-slide" i="5"><a>体育赛事</a></div>
							<div class="swiper-slide" i="6"><a>动画片</a></div>
							<div class="swiper-slide" i="7"><a>卡通电影</a></div>
							<!--<div class="swiper-slide" i="8"><a>移动APP</a></div>-->
							<div class="swiper-slide" i="8"><a>数字货币</a></div>
						</div>
					</div>
				</div>
				<input type="hidden" value="小说" class="keyword">
				<div class="list-wrap">
					<div id="" class="">
						<!--展示上拉加载的数据列表-->
						<ul id="dataList" class="data-list">
						</ul>
					</div>
				</div>
			</div>
		</div>
		<%if(fromCode && fromCode=='statement'){%>
		<div class="code_Module">
                <div class="module_statement">
                    <div class="module_content">
                        <h2><i class="icon iconfont icon-yonghu"></i>尊敬的用户:</h2>
                        <p class="module_text">版权百科暂未开放移动端【声明我的版权】功能服务，
							请通过PC端 www.banquanbaike.com.cn完成版权声明。</p>
                    </div>
                    <a class="module_btn">确定</a>
                </div>
		</div>
		<%}%>
	</body>
	<script>
        function isWeiXin() {
            var ua = window.navigator.userAgent.toLowerCase();
            console.log(ua);//mozilla/5.0 (iphone; cpu iphone os 9_1 like mac os x) applewebkit/601.1.46 (khtml, like gecko)version/9.0 mobile/13b143 safari/601.1
            if (ua.match(/MicroMessenger/i) == 'micromessenger') {
                return true;
            } else {
                return false;
            }
        }
        if(isWeiXin()){
//            document.getElementById('app-header').style.display='none';
        }else{
            console.log("不是来自微信内置浏览器")
        }
	</script>
	<script type="text/javascript" src="/app/lib/mescroll.js"></script>
	<script type="text/javascript" src="/app/lib/jquery-1.9.1.min.js"></script>
	<script type="text/javascript" src="/lib/swiper/swiper.min.js"></script>
	<script>
        var share = {
            title:"版权百科",
            imgUrl:"http://"+location.host+"/app/images/img_fm.png",
            link:location.href,
            desc:"版权数据服务专家",
            success:function(){
                //$(".share").hide();
            },
            cancel:function(){

            }
        };
	</script>
	<script type="text/javascript" src="/app/lib/wx.js"></script>
	<script type="text/javascript" src="/app/lib/wx.util.js"></script>
	<script type="text/javascript" charset="utf-8">
        $('.search_btn').click(function (){
            if($(this).prev().val()!=''){
                $(this).parent('.search-form').submit();
            }
        });
        $('.module_btn').click(function () {
            $('.code_Module').hide();
        })
        $(function(){
            var mySwiper = new Swiper('#topNav', {
                freeMode: true,
                freeModeMomentumRatio: 0.5,
                slidesPerView: 'auto',
            });
            var fixSwiper = new Swiper('#fixNav', {
                freeMode: true,
                freeModeMomentumRatio: 0.5,
                slidesPerView: 'auto',
            });
            //创建MeScroll对象,内部已默认开启下拉刷新,自动执行up.callback,刷新列表数据;
            var mescroll = new MeScroll("mescroll", {
                //上拉加载的配置项
                up: {
                    callback: getListData, //上拉回调,此处可简写; 相当于 callback: function (page) { getListData(page); }
                    noMoreSize: 4, //如果列表已无数据,可设置列表的总数量要大于半页才显示无更多数据;避免列表数据过少(比如只有一条数据),显示无更多数据会不好看; 默认5
                    empty: {
                        icon: "", //图标,默认null
                        tip: "暂未更多结果"//提示
//                        btntext: "去逛逛 >", //按钮,默认""
//                        btnClick: function(){//点击按钮的回调,默认null
//                            alert("点击了按钮,具体逻辑自行实现");
//                        }
                    },
                    toTop: {
                        src: "/app/images/mescroll-totop.png" //回到顶部按钮的图片路径
                    },
                    clearEmptyId: "dataList" //相当于同时设置了clearId和empty.warpId; 简化写法;默认null
                }
            });

            /*初始化菜单*/
            var pdType=0;//小说0; 动漫1; 音乐2; 电影3....;
			var keyWord=['小说','漫画','录音制品','电影','电视剧','体育赛事','动画片','卡通电影','数字货币'];



            $(".swiper-container").on('touchstart', function(e) {
                e.preventDefault()
            })

            mySwiper.on('tap', function(swiper, e) {
                //重置列表数据
				if(pdType!=this.clickedIndex) {
                    pdType=this.clickedIndex;
                    mescroll.resetUpScroll();
                    $("#topNav  .active").removeClass('active');
                    $("#fixNav  .active").removeClass('active');
                    $("#topNav .swiper-slide").eq(this.clickedIndex).addClass('active');
                    $("#fixNav .swiper-slide").eq(this.clickedIndex).addClass('active');

                    console.log($("#topNav .swiper-slide").eq(this.clickedIndex))
                }

            });
            fixSwiper.on('tap', function(swiper, e) {
                //重置列表数据
                if(pdType!=this.clickedIndex) {
                    pdType=this.clickedIndex;
                    mescroll.resetUpScroll();
                    $("#topNav  .active").removeClass('active');
                    $("#fixNav  .active").removeClass('active');
                    $("#topNav .swiper-slide").eq(this.clickedIndex).addClass('active');
                    $("#fixNav .swiper-slide").eq(this.clickedIndex).addClass('active');
                }

            })

            /*联网加载列表数据  page = {num:1, size:10}; num:当前页 从1开始, size:每页数据条数 */
            function getListData(page){
                //联网加载数据

                getListDataFromNet(pdType, page.num, page.size, function(data){
                    //联网成功的回调,隐藏下拉刷新和上拉加载的状态;
                    console.log("data.length="+data.length);
                    mescroll.endSuccess(data.length);//传参:数据的总数; mescroll会自动判断列表如果无任何数据,则提示空;列表无下一页数据,则提示无更多数据;
                    //设置列表数据
                    setListData(data,page.num);
                }, function(){
                    //联网失败的回调,隐藏下拉刷新和上拉加载的状态;
                    mescroll.endErr();
                });
            }

            /*设置列表数据*/
            function setListData(data,pageNum){
                var $list=$("#dataList");
                if(pageNum==1){
                    for (var i = 0; i < data.length; i++) {
                        var pd=data[i];
                        var result='',t='',cover='',$a=$('<a class="workHref" href="/item?id='+pd.seqNo+'"></a>');
                        if(pd.workTitle&&pd.workTitle!=null&&pd.workTitle!=''){
                            t+='<span class="works-title">（'+pd.workTitle+'）</span>'
                        }
                        if(pd.cover&&pd.cover!=null&&pd.cover!=''){
                            if(pd.type=='录音制品' || pd.type=='词谱' || pd.type=='曲谱' || pd.type=='词曲谱'){
                                cover+='<a class="cover-img cover_music" style="background-image: url('+pd.cover+')"></a>'
							}else if(pd.type=='操作系统' || pd.type=='移动APP' || pd.type=='PC软件'){
                                cover+='<a class="cover-img cover_app" style="background-image: url('+pd.cover+')"></a>'
							}else{
                                cover+='<a class="cover-img" style="background-image: url('+pd.cover+')"></a>'
							}

                        }else{
                            if(pd.type=='录音制品' || pd.type=='词谱' || pd.type=='曲谱' || pd.type=='词曲谱'){
                                cover+='<a class="app-images img_mr cover_music"></a>'
                            }else if(pd.type=='操作系统' || pd.type=='移动APP' || pd.type=='PC软件'){
                                cover+='<a class="app-images img_mr cover_app"></a>'
                            }else{
                                cover+='<a class="app-images img_mr"></a>'
                            }
                        }
                        result +='<div class="name-wrap">' +
                            '<span class="works-name">'+pd.name+'</span>' +t+ '</div>' +
                            '<div class="clearfix content-wrap"><div class="float_left">' + cover +
                            '<span class="rankNum app-images no_0'+(i+1)+'"></span>' +
                            '</div>' +
                            '<div class="float_right right-content">' +
                            '<p class="works-content">'+pd.synopsis+'</p>' +
                            '<p class="works-btns">' +
                            '<a class="float_right" href="/item?id='+pd.seqNo+'&from=bql"><span class="app-images icon_bql"></span>版权链</a>' +
                            '<a class="float_right" href="/copy/get?id='+pd.seqNo+'&workName='+pd.name+'"><span class="app-images icon_bq"></span>获得版权授权</a>' +
                            '<a class="float_right" href="/copy/sm?id='+pd.seqNo+'&workName='+pd.name+'"><span class="app-images icon_sm"></span>声明我的版权</a>' +
                            '</p></div></div>';
                        var $s='';
                        $a.html(result);
                        if(pd.copyrights.length>0){
                            $s=$('<div class="yz-item"></div>');
                            $s.html('<span>原著</span><span>'+pd.copyrights[0].name+'</span><a href="/app_copyInfo/'+pd.copyrights[0].id+'">查看</a></div>')
                        }
                        var $li=$("<li></li>");
                        $li.append($a);
                        $li.append($s);
                        $list.append($li);
                    }
				}else{
                    for (var i = 0; i < data.length; i++) {
                        var pd=data[i];
                        var result='',t='',cover='',listTags='',$a=$('<a class="workHref" href="/item?id='+pd.seqNo+'"></a>');
                        if(pd.workTitle&&pd.workTitle!=null&&pd.workTitle!=''){
                            t+='<span class="works-title">（'+pd.workTitle+'）</span>'
                        }
                        if(pd.cover&&pd.cover!=null&&pd.cover!=''){
                            if(pd.type=='录音制品' || pd.type=='词谱' || pd.type=='曲谱' || pd.type=='词曲谱'){
                                cover+='<a class="cover-img cover_music" style="background-image: url('+pd.cover+')"></a>'
                            }else if(pd.type=='操作系统' || pd.type=='移动APP' || pd.type=='PC软件'){
                                cover+='<a class="cover-img cover_app" style="background-image: url('+pd.cover+')"></a>'
                            }else{
                                cover+='<a class="cover-img" style="background-image: url('+pd.cover+')"></a>'
                            }

                        }else{
                            if(pd.type=='录音制品' || pd.type=='词谱' || pd.type=='曲谱' || pd.type=='词曲谱'){
                                cover+='<a class="app-images img_mr cover_music"></a>'
                            }else if(pd.type=='操作系统' || pd.type=='移动APP' || pd.type=='PC软件'){
                                cover+='<a class="app-images img_mr cover_app"></a>'
                            }else{
                                cover+='<a class="app-images img_mr"></a>'
                            }
                        }
                        if(pd.type=="录音制品"){
                            listTags= '<span class="app-images listTags">'+'音乐'+'</span>'
                        }else{
                            listTags= '<span class="app-images listTags">'+pd.type+'</span>'
                        }
                        result +='<div class="name-wrap">' +
                            '<span class="works-name">'+pd.name+'</span>' +t+ '</div>' +
                            '<div class="clearfix content-wrap"><div class="float_left">' + cover + listTags +
                            '</div>' +
                            '<div class="float_right right-content">' +
                            '<p class="works-content">'+pd.synopsis+'</p>' +
                            '<p class="works-btns">' +
                            '<a class="float_right" href="/item?id='+pd.seqNo+'&from=bql"><span class="app-images icon_bql"></span>版权链</a>' +
                            '<a class="float_right" href="/copy/get?id='+pd.seqNo+'&workName='+pd.name+'"><span class="app-images icon_bq"></span>获得版权授权</a>' +
                            '<a class="float_right" href="/copy/sm?id='+pd.seqNo+'&workName='+pd.name+'"><span class="app-images icon_sm"></span>声明我的版权</a>' +
                            '</p></div></div>';
                        var $s='';
                        $a.html(result);
                        if(pd.copyrights.length>0){
                            $s=$('<div class="yz-item"></div>');
                            $s.html('<span>原著</span><span>'+pd.copyrights[0].name+'</span><a href="/app_copyInfo/'+pd.copyrights[0].id+'">查看</a></div>')
                        }
                        var $li=$("<li></li>");
                        $li.append($a);
                        $li.append($s);
                        $list.append($li);
                    }
				}

            }

            /*联网加载列表数据*/
            function getListDataFromNet(pdType,pageNum,pageSize,successCallback,errorCallback) {
                //延时一秒,模拟联网
                setTimeout(function () {
                    $.ajax({
                        type: 'GET',
                        url: '/app/list?keyword='+keyWord[pdType]+'&currentPage='+pageNum,
                        dataType: 'json',
                        success: function(data){
                   			 //回调
							if(data.data.resultCode==200){
                                successCallback(data.data.result.workList);
							}else{
                                errorCallback
							}

		                },
		                error: errorCallback
		            });
                },1000)
            }

            //禁止PC浏览器拖拽图片,避免与下拉刷新冲突;如果仅在移动端使用,可删除此代码
            document.ondragstart=function() {return false;}
        });
	</script>
</html>
